<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
			}
			.containerListPriceReduce,.containerListPricePlus{
				cursor:Pointer;
			}
		</style>
	</head>

	<body>
		<ul class="container">
			<div class="containerTotalPrice">总价格：0元</div>
			<!--<li class="containerList">
				<span class="containerListName"></span>
				<span class="containerListPrice"></span>
				<span class="containerListPriceReduce">-</span>
				<input type="text" class="containerListCount" />
				<span class="containerListPricePlus">+</span>
			</li>-->
		</ul>
		<script src="js/jq3_2_1.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			function PageSon(commodity) {
				this.commodity = commodity;
				this.price = commodity.price;
				this.count = 1;
				this.init();
			}
			$.extend(PageSon.prototype, {
				init() {
					this.createShopDom();
					this.bindEvents();
				},
				createShopDom() {
					var html = `<li class="containerList">
						<span class="containerListName">${this.commodity.name}</span>
						<span class="containerListPrice">价格: ${this.commodity.price}</span>
						<span class="containerListPriceReduce">-</span>
						<span class="containerListCount" style="color:#f00">${this.count}</span>
						<span class="containerListPricePlus">+</span>
					</li>`;
					this.ele = $(html);
					this.reduce = this.ele.find(".containerListPriceReduce");
					this.plus = this.ele.find(".containerListPricePlus");
					this.listCount = this.ele.find(".containerListCount");
					$(".container").append(this.ele);
				},
				bindEvents() {
					this.reduce.on("click", $.proxy(this.handleClick, this));
					this.plus.on("click", $.proxy(this.handleClick, this));
				},
				handleClick(e) {
					this.count = this.listCount.html();
					if($(e.currentTarget).html() == "-") {
						this.count = this.count-- <= 0 ? 0 : this.count--;
					} else if($(e.currentTarget).html() == "+") {
						this.count = this.count++ >= this.commodity.count ? this.commodity.count : this.count++;
					}
					this.listCount.html(this.count);
					$(this).trigger("change");
				}
			})

			function Page() {
				this.shopMessage = [];
			}
			$.extend(Page.prototype, {
				init() {
					this.getShopMessage();
				},
				getShopMessage() {
					$.ajax({
						type: "get",
						url: "json/machine.json",
						success: $.proxy(this.getShopMessageSuccess, this),
						error: $.proxy(this.getShopMessageError, this)
					});
				},
				getShopMessageSuccess(res) {
					if(res.code == "0000" && res.data && res.data.shop && res.data.shop.length > 0) {
						this.shopArr = res.data.shop;
						for(var i = 0; i < this.shopArr.length; i++) {
							var product = new PageSon(this.shopArr[i]);
							this.shopMessage.push(product);
							$(product).on("change", $.proxy(this.handleShopMessageChange, this));
						}
					}
				},
				getShopMessageError(res) {
					console.log("error");
				},
				handleShopMessageChange() {
					var totalPrice = 0;
					for(var i = 0; i < this.shopMessage.length; i++) {
						totalPrice += (this.shopMessage[i].price * this.shopMessage[i].count);
						console.log(this.shopMessage[i].price+"-"+this.shopMessage[i].count)
					}
					$(".containerTotalPrice").html("总价格：" + totalPrice + "元");
				}
			})
			var page = new Page();
			page.init();
		</script>
	</body>

</html>